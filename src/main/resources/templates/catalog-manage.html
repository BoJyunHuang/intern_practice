<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>カタログ</title>
<!-- Bootstrap-->
<link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.3/css/bootstrap.min.css}">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- CSS -->
<link rel="stylesheet" th:href="@{/admin-style.css}" />
<!-- JQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<!-- data tables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
<!-- Font Awesome icons (free version)-->
<script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"></script>
</head>
<body>
	<!-- mainNav -->
	<div th:replace="admin::mainNav"></div>
	<!-- layout -->
	<div id="layoutSidenav">
		<!-- sideNav -->
		<div th:replace="admin::sideNav"></div>
		<!-- content -->
		<div id="layoutSidenav_content">
			<main>
				<div class="container-fluid px-4">
					<h1 class="mt-4">カタログ</h1>
					<ol class="breadcrumb mb-4">
						<li class="breadcrumb-item">
							<a th:href="@{/admin}">管理</a>
						</li>
						<li class="breadcrumb-item active">カタログ</li>
					</ol>
					<div class="card mb-4">
						<div class="card-body d-flex justify-content-between">
							<a th:href="@{/add_catalog}" class="btn btn-primary mx-5">新規追加</a>
							<a class="btn btn-danger mx-5" th:attr="onclick='confirmDelete(\'' + (*{catalogId} ?: '') + '\', \'catalog\')'">削除</a>
						</div>
					</div>
					<div class="card mb-4">
						<div class="card-header">
							<i class="fas fa-table me-1"></i> カタログリスト
						</div>
						<div class="card-body">
							<table id="catalogTable" class="display">
								<thead>
									<tr>
										<th></th>
										<th>カタログID</th>
										<th>名前</th>
										<th>親カタログ</th>
										<th>ニュース数</th>
										<th>操作</th>
										<th>選ぶ</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="catalog : ${catalogList}" th:object="${catalog}" th:if="${!catalog.deleteFlag}">
										<td>
											<button onclick="revealNews(this)" th:if="${#sets.size(catalog.news) > 0}">
												<i class="fa-solid fa-plus"></i>
											</button>
										</td>
										<td th:text="*{catalogId}"></td>
										<td th:text="*{name}"></td>
										<td th:text="*{parent == 'カタログ' ? '--' : parent}"></td>
										<td th:text="*{#sets.size(news)}"></td>
										<td>
											<a class="btn btn-primary mx-5" th:href="@{/revise_catalog/{catalogId}(catalogId=*{catalogId})}">編集</a>
											<a class="btn btn-danger mx-5" th:attr="onclick='confirmDelete(\'' + (*{catalogId} ?: '') + '\', \'catalog\')'">削除</a>
										</td>
										<td>
											<input type="checkbox" class="catalog-checkbox" th:value="*{catalogId}">
										</td>
									</tr>
									<tr th:each="catalog : ${catalogList}" th:object="${catalog}" th:if="${#sets.size(catalog.news) > 0}">
										<td></td>
										<td th:text="*{catalogId}" class="d-none"></td>
										<td colspan="6">
											<table class="table">
												<thead>
													<tr>
														<th>タイトル</th>
														<th>公開日時</th>
														<th>取り下げる日時</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="news : ${catalog.news}" th:object="${news}">
														<td th:text="*{title}"></td>
														<td th:text="*{#temporals.format(publishTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
														<td th:text="*{#temporals.format(expirationTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
													</tr>
												</tbody>
											</table>
										</td>
										<td style="display: none;"></td>
										<td style="display: none;"></td>
										<td style="display: none;"></td>
										<td style="display: none;"></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</main>
			<div class="d-flex justify-content-center mb-4">
				<button class="btn btn-light" onclick="goBack()">戻る</button>
			</div>
			<!-- footer -->
			<div th:replace="admin::footer"></div>
		</div>
	</div>
	<!-- JS -->
	<script th:src="@{/js/admin.js}" type="text/javascript"></script>
</body>
</html>